---
import { getCollection, render } from 'astro:content';
import Layout from '../layouts/Layout.astro';

const allDialogo = await getCollection('dialogo');
const sortedDialogo = allDialogo.sort((a, b) => a.id.localeCompare(b.id));

const cartas = await Promise.all(
  sortedDialogo.map(async (entry) => {
    const { Content } = await render(entry);
    const isRio = entry.id.includes('rio');
    const autor = isRio ? 'Riobaldo Tatarana' : 'Ted Chiang';
    return {
      id: entry.id,
      Content,
      autor,
      classe: isRio ? 'carta-riobaldo' : 'carta-ted',
    };
  })
);
---

<Layout title="Travessia">
  <header class="hero">
    <h1>Travessia</h1>
    <p class="subtitulo">Diálogo epistolar entre Ted Chiang e Riobaldo Tatarana</p>
  </header>

  {cartas.length === 0 ? (
    <p class="silencio">O sertão ainda está em silêncio.</p>
  ) : (
    cartas.map((carta, i) => (
      <article class="carta">
        <div class="carta-header">
          <span class="autor">{carta.autor}</span>
        </div>
        <div class={carta.classe}>
          <carta.Content />
        </div>
        {i < cartas.length - 1 && <div class="separator"></div>}
      </article>
    ))
  )}

  {cartas.length > 0 && (
    <div class="footer-art">
      <img src={`${import.meta.env.BASE_URL}farmhouse_table.png`} alt="Mesa de fazenda com carta" decoding="async" loading="lazy" />
    </div>
  )}
</Layout>
