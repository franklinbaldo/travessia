---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';

const allPosts = await getCollection('dialogo');
const sortedPosts = allPosts.sort((a, b) =>
  new Date(b.data.data).getTime() - new Date(a.data.data).getTime()
);

function formatDate(date: Date): string {
  return new Intl.DateTimeFormat('pt-BR', {
    day: 'numeric',
    month: 'long',
    year: 'numeric',
  }).format(date);
}
---

<Layout title="Travessia">

  <header class="blog-header">
    <h1>Travessia</h1>
    <p class="subtitulo">Diálogo epistolar entre Ted Chiang e Riobaldo Tatarana</p>
  </header>

  {sortedPosts.length === 0 ? (
    <p class="silencio">O sertão ainda está em silêncio.</p>
  ) : (
    <ul class="blog-list">
      {sortedPosts.map((post) => {
        const isRio = post.data.autor.includes('Riobaldo');
        return (
          <li class="blog-item">
            <a href={`${import.meta.env.BASE_URL}post/${post.id}`} class="blog-link">
              <article>
                <h2 class="blog-title">{post.data.titulo}</h2>
                <div class="blog-meta">
                  <span class={`blog-autor ${isRio ? 'autor-rio' : 'autor-ted'}`}>{post.data.autor}</span>
                  <time datetime={post.data.data.toISOString()}>
                    {formatDate(new Date(post.data.data))}
                  </time>
                </div>
              </article>
            </a>
          </li>
        );
      })}
    </ul>
  )}

</Layout>
